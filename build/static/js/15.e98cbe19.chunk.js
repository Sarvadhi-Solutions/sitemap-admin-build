(this["webpackJsonpZopto-Web"]=this["webpackJsonpZopto-Web"]||[]).push([[15],{1399:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Z}));var i=n(6),a=n(13),l=n(2),r=n(17),o=n(10),c=n(1236),d=n(630),u=n(1239),s=n(628),b=n(1298),v=n(1228),j=n(23),p=n(126),h=n(61),f=n(1318),O=n(321),x=n(1312),m=n(1),g=n(1343),y=n.n(g),w=n(1345),_=n.n(w),S=(n(1344),n(28)),C=n(1340),k=n(32),I=n(20),W=n(64),D=n(152),E=n(1306),P=n(153),R=n(1398),L=n(1349),F=n(1365),H=n(1403),z=n(1348),A=n.n(z),M=n(1336),B=n.n(M),J=n(1405),N=n(1309),U=n(52),T=n(0);function Z(){var e,t=Object(m.useState)({width:0,height:0}),n=Object(o.a)(t,2),g=(n[0],n[1],Object(m.useState)(null)),w=Object(o.a)(g,2),z=w[0],M=w[1],Z=Object(m.useState)(""),q=Object(o.a)(Z,2),Q=q[0],V=q[1],G=Object(m.useState)(!1),K=Object(o.a)(G,2),X=K[0],Y=K[1],$=Object(m.useState)(null),ee=Object(o.a)($,2),te=(ee[0],ee[1],Object(m.useState)([])),ne=Object(o.a)(te,2),ie=ne[0],ae=ne[1],le=Object(m.useState)(null),re=Object(o.a)(le,2),oe=(re[0],re[1],Object(m.useState)({value:"",label:""})),ce=Object(o.a)(oe,2),de=ce[0],ue=ce[1],se=Object(m.useState)(),be=Object(o.a)(se,2),ve=be[0],je=be[1],pe=Object(m.useState)([]),he=Object(o.a)(pe,2),fe=he[0],Oe=he[1],xe=Object(m.useState)(),me=Object(o.a)(xe,2),ge=me[0],ye=me[1],we=Object(m.useState)([]),_e=Object(o.a)(we,2),Se=_e[0],Ce=_e[1],ke=Object(m.useState)(),Ie=Object(o.a)(ke,2),We=Ie[0],De=Ie[1],Ee=Object(m.useState)([]),Pe=Object(o.a)(Ee,2),Re=Pe[0],Le=Pe[1],Fe=Object(m.useState)([]),He=Object(o.a)(Fe,2),ze=He[0],Ae=He[1],Me=Object(m.useState)(null),Be=Object(o.a)(Me,2),Je=Be[0],Ne=Be[1],Ue=Object(m.useState)(null),Te=Object(o.a)(Ue,2),Ze=Te[0],qe=Te[1],Qe=Object(m.useState)([]),Ve=Object(o.a)(Qe,2),Ge=Ve[0],Ke=Ve[1],Xe=Object(m.useRef)(null),Ye=Object(m.useState)(null),$e=Object(o.a)(Ye,2),et=$e[0],tt=$e[1],nt=Object(k.b)(),it=Object(W.b)().enqueueSnackbar,at=Object(j.o)().couponId,lt=new Date;Object(m.useEffect)((function(){nt(Object(P.b)(at))}),[]);var rt=Object(I.d)((function(e){var t;return null===e||void 0===e||null===(t=e.coupon)||void 0===t?void 0:t.coupon}));Object(m.useEffect)((function(){var e,t,n,i,a,l;ue({value:null===rt||void 0===rt||null===(e=rt.brand)||void 0===e?void 0:e.brand_name,label:null===rt||void 0===rt||null===(t=rt.brand)||void 0===t?void 0:t.id}),je({value:null===rt||void 0===rt||null===(n=rt.state)||void 0===n?void 0:n.id,label:null===rt||void 0===rt||null===(i=rt.state)||void 0===i?void 0:i.name}),ae(null===rt||void 0===rt||null===(a=rt.cities)||void 0===a?void 0:a.map((function(e){return{value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name}}))),Ne(B()(null===rt||void 0===rt?void 0:rt.start_date)),qe(B()(null===rt||void 0===rt?void 0:rt.expiry_date)),V(null===rt||void 0===rt?void 0:rt.image),M(null===rt||void 0===rt?void 0:rt.image);var r=[],o=[],c=[];null===rt||void 0===rt||null===(l=rt.crop_images)||void 0===l||l.map((function(e,t){r.push(null===e||void 0===e?void 0:e.crop_coordinate),o.push({id:null===e||void 0===e?void 0:e.id,url:null===e||void 0===e?void 0:e.url}),c.push({id:null===e||void 0===e?void 0:e.id,name:null===e||void 0===e?void 0:e.name})})),Ce(o),Le(r),Ke(c)}),[rt]);var ot=function(){var e=Object(r.a)(Object(i.a)().mark((function e(t,n){var r,o,c,d,u,s,b,v,j;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Xe.current&&t.width&&t.height)){e.next=22;break}if(r=document.createElement("canvas"),console.log({"pixelCrop=============>>>>":n}),!(o=r.getContext("2d"))||!Xe.current){e.next=22;break}return e.next=7,Xe.current;case 7:c=e.sent,d=c.naturalWidth/c.width,u=c.naturalHeight/c.height,s=window.devicePixelRatio,r.width=Math.floor(t.width*d*s),r.height=Math.floor(t.height*u*s),o.scale(s,s),o.imageSmoothingQuality="high",1,b=t.x*d,v=t.y*u,o.save(),o.scale(1,1),o.drawImage(Xe.current,b,v,r.width,r.height,0,0,r.width,r.height),We&&t.x===We.x&&t.y===We.y&&t.width===We.width&&t.height===We.height||(j=Object(J.a)(),tt(j),De(Object(l.a)(Object(l.a)({},t),{},{id:j})),Le([].concat(Object(a.a)(Re),[Object(l.a)(Object(l.a)({},t),{},{id:j})])),Ce([].concat(Object(a.a)(Se),[{id:j,url:r.toDataURL()}])));case 22:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();Object(m.useEffect)((function(){nt(Object(D.c)()),nt(Object(D.a)()),nt(Object(D.d)())}),[]);var ct=null===de||void 0===de?void 0:de.label,dt=Object(I.d)((function(e){var t;return null===e||void 0===e||null===(t=e.brand)||void 0===t?void 0:t.brandList})),ut=Object(I.d)((function(e){var t;return null===e||void 0===e||null===(t=e.brand)||void 0===t?void 0:t.cities})),st=null===ve||void 0===ve?void 0:ve.value,bt=null===dt||void 0===dt||null===(e=dt.find((function(e){return e.id===ct})))||void 0===e?void 0:e.states,vt=null===ut||void 0===ut?void 0:ut.filter((function(e){return e.state_id===st})),jt=Object(I.d)((function(e){var t;return null===e||void 0===e||null===(t=e.brand)||void 0===t?void 0:t.error}));Object(m.useEffect)((function(){jt&&it(jt.message,{variant:"error"})}),[jt]),Object(m.useEffect)((function(){if(ut&&ve){var e=null===vt||void 0===vt?void 0:vt.map((function(e){return{value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name}}));Ae([{value:"all-cities",label:"Select all Cities"}].concat(Object(a.a)(e)))}}),[ut,ve]),Object(m.useEffect)((function(){if(bt){var e=null===bt||void 0===bt?void 0:bt.map((function(e){return{value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name}}));Oe(e)}}),[bt]);var pt=function(e){for(var t,n=null===e||void 0===e?void 0:e.url.split(","),i=null===(t=n[0])||void 0===t?void 0:t.match(/:(.*?);/)[1],a=atob(n[1]),l=a.length,r=new Uint8Array(l);l--;)r[l]=a.charCodeAt(l);return new Blob([r],{type:i})},ht=function(){var e=Object(r.a)(Object(i.a)().mark((function e(){var t,n,a,l,o,c;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Date.now(),de){e.next=6;break}return it("Please select the brand",{variant:"error"}),e.abrupt("return");case 6:if(ie.length){e.next=11;break}return it("Please select atleast one city",{variant:"error"}),e.abrupt("return");case 11:if(ve){e.next=16;break}return it("Please select state",{variant:"error"}),e.abrupt("return");case 16:if(Je&&Ze){e.next=21;break}return it("Please select the date",{variant:"error"}),e.abrupt("return");case 21:if(!(Ze<Je||Ze<t)){e.next=26;break}return it("Please add a valid TO date",{variant:"error"}),e.abrupt("return");case 26:if(!(Je<B()(lt).startOf("day").valueOf())){e.next=31;break}return it("Please add a valid FROM date",{variant:"error"}),e.abrupt("return");case 31:if(Q){e.next=36;break}return it("Please upload a image",{variant:"error"}),e.abrupt("return");case 36:Y(!0);case 37:return n=null===ie||void 0===ie?void 0:ie.map((function(e){return null===e||void 0===e?void 0:e.value})),a=JSON.stringify(Re),l=new FormData,o=null===ve||void 0===ve?void 0:ve.value,l.append("image",Q),n.map((function(e){l.append("city_id",e)})),l.append("start_date",Je),l.append("expiry_date",Ze),l.append("state_id",o),l.append("crop_coordinate",a),Se.forEach(function(){var e=Object(r.a)(Object(i.a)().mark((function e(t,n){var a,r;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Ge[n],l.append("crop_image_name",a.name),console.log(t,"url ===============>"),console.log("crop_image_name",a),t.url.startsWith("data:image/png;base64")?t&&(r=pt(t),l.append("crop_images",r,"".concat(a.name,".png")),console.log("crop_images",r,"".concat(a.name,".png"))):(l.append("crop_url",t.url),console.log("crop_url",t.url),console.log("Not a Base64-encoded image")),l.append("crop_image_id",t.id),console.log("url.id",t.id);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=50,nt(Object(P.f)(at,l));case 50:null!==(c=e.sent)&&void 0!==c&&c.status&&(it("Coupon SuccessFully Updated!!"),ue(null),je(null),ae([]),V(null),Ce([]),Ne(null),qe(null),M(null),De(null),Le([]),ye(null)),Y(!1),ft(U.b.general.coupon);case 54:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ft=Object(j.m)(),Ot=function(){ft(U.b.general.coupon)};return Object(m.useEffect)((function(){return window.addEventListener("popstate",Ot),function(){window.removeEventListener("popstate",Ot)}}),[]),Object(T.jsxs)(T.Fragment,{children:[X&&Object(T.jsx)(c.a,{open:X,sx:{color:"#fff",zIndex:function(e){return e.zIndex.drawer+1}},children:Object(T.jsx)(d.a,{color:"inherit"})}),Object(T.jsx)(N.a,{children:Object(T.jsxs)(u.a,{children:[Object(T.jsx)(p.a,{heading:Object(T.jsxs)(f.a,{direction:"row",alignItems:"center",children:[Object(T.jsx)(s.a,{onClick:Ot,children:Object(T.jsx)(_.a,{})}),Object(T.jsx)("span",{style:{marginLeft:8},children:"Edit Coupon"})]}),links:[],sx:{m:2},action:Object(T.jsx)(O.a,{variant:"contained",startIcon:Object(T.jsx)(S.a,{icon:"eva:plus-fill"}),onClick:function(){ht()},children:"Save"})}),Object(T.jsx)(h.a,{children:Object(T.jsx)(f.a,{spacing:3,sx:{p:"24px 24px 82px",minHeight:"500px"},children:Object(T.jsx)(x.a,{container:!0,spacing:3,sx:{mb:2},children:Object(T.jsxs)(x.a,{item:!0,xs:12,md:12,children:[Object(T.jsxs)(f.a,{spacing:3,direction:"row",sx:{mt:2},children:[Object(T.jsx)(E.a,{id:"brand-label",style:{display:"flex",alignItems:"center",fontWeight:900},children:"Brand"}),Object(T.jsx)(b.a,{disabled:!0,id:"outlined-read-only-input",defaultValue:"Hello World",value:null===de||void 0===de?void 0:de.value,InputProps:{readOnly:!0}})]}),Object(T.jsxs)(f.a,{spacing:3,direction:"row",sx:{mt:2},children:[Object(T.jsx)(E.a,{id:"state-label",style:{display:"flex",alignItems:"center",fontWeight:900},children:"State"}),Object(T.jsx)(C.a,{placeholder:"select state",options:fe,value:ve,onChange:function(e){return je(e),void ae([])}})]}),Object(T.jsxs)(f.a,{spacing:3,direction:"row",sx:{mt:2},children:[Object(T.jsx)(E.a,{id:"city-label",style:{display:"flex",alignItems:"center",fontWeight:900,marginRight:"14px"},children:"City"}),Object(T.jsx)(C.a,{isMulti:!0,placeholder:"select cities",options:ze,value:ie,onChange:function(e){return function(e){var t=ze.filter((function(e){return"all-cities"!==e.value}));e.some((function(e){return"all-cities"===e.value}))?ae(t):ae(e)}(e)}})]}),Object(T.jsxs)(f.a,{spacing:3,direction:"row",sx:{mt:1},children:[Object(T.jsx)(E.a,{id:"expirydate-label",style:{display:"flex",alignItems:"center",fontWeight:900},children:"Expiry Date :"}),Object(T.jsx)(E.a,{id:"fromDate-label",style:{display:"flex",alignItems:"center",fontWeight:900,overflow:"visible"},children:"From"}),Object(T.jsx)(F.a,{dateAdapter:L.a,children:Object(T.jsx)(R.a,{components:["DatePicker"],children:Object(T.jsx)(H.a,{label:"Select Date",value:Je,minDate:B()(lt),onChange:function(e){return Ne(e)}})})}),Object(T.jsx)(E.a,{id:"to-label",style:{display:"flex",alignItems:"center",fontWeight:900,overflow:"visible"},children:"To"}),Object(T.jsx)(F.a,{dateAdapter:L.a,children:Object(T.jsx)(R.a,{components:["DatePicker"],children:Object(T.jsx)(H.a,{label:"Select Date",value:Ze,minDate:B()(lt),onChange:function(e){return qe(e)}})})})]}),Object(T.jsx)(f.a,{spacing:3,direction:"row",justifyContent:"flex-start",sx:{mt:2,mb:3},children:Object(T.jsx)(E.a,{id:"iamge-label",style:{display:"flex",alignItems:"center",fontWeight:900},children:"Image"})}),Object(T.jsx)(f.a,{spacing:3,direction:"row",justifyContent:"flex-start",sx:{mt:1}}),Object(T.jsxs)("div",{style:{position:"relative",display:"flex",flexDirection:"row",flexWrap:"wrap"},children:[z&&Object(T.jsx)("div",{style:{position:"relative",marginRight:"50px"},children:Object(T.jsx)(y.a,{crop:ge,onChange:function(e){return ye(e)},onComplete:ot,children:Object(T.jsx)("img",{crossOrigin:"anonymous",ref:Xe,src:z,alt:"avatar",style:{width:"".concat(null===rt||void 0===rt?void 0:rt.image_dimension.main_image_width,"px"),height:"".concat(null===rt||void 0===rt?void 0:rt.image_dimension.main_image_height,"px"),minWidth:"".concat(null===rt||void 0===rt?void 0:rt.image_dimension.main_image_width,"px"),minHeight:"".concat(null===rt||void 0===rt?void 0:rt.image_dimension.main_image_height,"px"),maxWidth:"".concat(null===rt||void 0===rt?void 0:rt.image_dimension.main_image_width,"px"),maxHeight:"".concat(null===rt||void 0===rt?void 0:rt.image_dimension.main_image_height,"px")}})})}),ge&&(null===Re||void 0===Re?void 0:Re.map((function(e,t){return Object(T.jsx)("div",{style:{position:"absolute",width:null===e||void 0===e?void 0:e.width,height:null===e||void 0===e?void 0:e.height,top:null===e||void 0===e?void 0:e.y,left:null===e||void 0===e?void 0:e.x,backgroundColor:"rgba(188, 68, 68, 0.5)",zIndex:2}},t)}))),(null===Se||void 0===Se?void 0:Se.length)>0&&Object(T.jsx)(f.a,{spacing:3,direction:"column",justifyContent:"flex-start",sx:{mt:1,ml:5},children:null===Se||void 0===Se?void 0:Se.map((function(e,t){var n;return Object(T.jsxs)("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:[Object(T.jsxs)("div",{style:{position:"relative",width:"100px",height:"100px"},children:[Object(T.jsx)("img",{src:e.url,alt:"cropped-".concat(t),style:{width:"100px",height:"100px"}}),Object(T.jsx)("div",{style:{position:"absolute",top:"0",right:"0",padding:"5px",cursor:"pointer",color:"white",backgroundColor:"rgba(0, 0, 0,0.5)",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(T.jsx)(A.a,{onClick:function(){return t=e.id,Ce(Se.filter((function(e){return e.id!==t}))),Le(Re.filter((function(e){return e.id!==t}))),void Ke(Ge.filter((function(e){return e.id!==t})));var t}})})]}),Object(T.jsx)("div",{children:Object(T.jsx)("input",{type:"text",name:"name",placeholder:"Crop Coupon Name",value:(null===(n=Ge[t])||void 0===n?void 0:n.name)||"",onChange:function(e){return function(e,t){var n=Object(a.a)(Ge);n[e]={id:et,name:t},Ke(n)}(t,e.target.value)},style:{marginLeft:20,border:"1px solid hsl(0, 0%, 80%)",transition:"opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",borderRadius:5,padding:5}})})]},t)}))})]})]})})})}),Object(T.jsx)(v.a,{})]})})]})}}}]);
//# sourceMappingURL=15.e98cbe19.chunk.js.map